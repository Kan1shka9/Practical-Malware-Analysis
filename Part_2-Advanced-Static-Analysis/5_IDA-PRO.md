#### 5. IDA PRO

- [`Interactive Disassembler Professional`](https://www.hex-rays.com/products/ida/support/download.shtml)
- IDA Pro includes extensive code signatures within its `Fast Library Identification and Recognition Technology (FLIRT)`, which allows it to recognize and label a disassembled function, especially library code added by a compiler.

###### Loading in IDA Pro

- EXE
	- Binary &rarr; This option can prove useful because malware sometimes appends shellcode, additional data, encryption parameters, and even additional executables to legitimate PE files, and this extra data won’t be loaded into memory when the malware is run by Windows or loaded into IDA Pro. In addition, when you are loading a raw binary file containing shellcode, you should choose to load the file as a binary file and disassemble it.

![](images/5/1.png)

![](images/5/2.png)

![](images/5/4.png)

`binary`

![](images/5/5.png)

![](images/5/6.png)

- DLLs

PE files are compiled to load at a preferred base address in memory, and if the Windows loader can’t load it at its preferred address (because the address is already taken), the loader will perform an operation known as `rebasing`. This most often happens with `DLLs`, since they are often loaded at locations that differ from their preferred address. For now, you should know that if you encounter a DLL loaded into a process different from what you see in IDA Pro, it could be the result of the file being rebased. When this occurs, check the Manual Load checkbox and you’ll see an input box where you can specify the new virtual base address in which to load the file.

![](images/5/7.png)

![](images/5/8.png)

![](images/5/9.png)

![](images/5/10.png)

![](images/5/11.png)

###### IDA Pro Interface

- Graph Mode &rarr; `Spacebar` &rarr; Text Mode

![](images/5/12.png)

![](images/5/13.png)

![](images/5/14.png)

![](images/5/15.png)

![](images/5/16.png)

Highlighting text in graph mode highlights every instance of that text in the disassembly window.

**Symbols/Color** | **Operation**
:-----:|:-----:
red|conditional jump is not taken
gree|jump is taken
blue|unconditional jump
upward arrows|loop

It displays the memory address `0040105B` and section name `.text` in which the opcodes `83EC18` will reside in memory {`1`}. The left portion of the text-mode display is known as the arrows window and shows the program’s nonlinear flow. Solid lines mark unconditional jumps, and dashed lines mark conditional jumps. Arrows facing up indicate a loop. The example includes the stack layout for the function at {`2`} and a comment (beginning with a semicolon) that was automatically added by IDA Pro {`3`}.

![](images/5/17.png)

- Windows for Analysis

	- Functions window - `L` &rarr; indicates library functions so skip these
		![](images/5/19.png)
		
	- Names window
		![](images/5/20.png)
		
	- Strings window
		![](images/5/21.png)
		
	- Imports window
		![](images/5/22.png)
		
	- Exports window
		![](images/5/23.png)
		
	- Structures window
		![](images/5/24.png)

![](images/5/18.png)

`reset views`

![](images/5/25.png)

###### Navigating IDA Pro

- Links
	- `Sub links` are links to the start of functions such as `printf` and `sub_4010A0`
	- `Loc links` are links to jump destinations such as `loc_40107E` and `loc_401097`
	- `Offset links` are links to an offset in memory

![](images/5/26.png)

- Navigate History

![](images/5/27.png)

- Navigation Band

**Color**|**Type**
:-----:|:-----:
Light blue|Library code as recognized by `FLIRT`
Red |compiler-generated code
Dark blue|user-written code

![](images/5/28.png)

- Jump to Location

![](images/5/29.png)

- Searching

![](images/5/30.png)

![](images/5/31.png)

![](images/5/32.png)

![](images/5/33.png)

![](images/5/34.png)

- Code Cross-References - `xref`
	- Where a function is called or where a string is used
	- If you identify a useful function and want to know the parameters with which it is called, you can use a cross-reference to navigate quickly to the location where the parameters are placed on the stack.
	- {`1`} shows a code cross-reference at that tells us that this function (`sub_401000`) is called from inside the main function at offset `0x3` into the main function. {`2`} the code cross-reference for the jump at tells us which jump takes us to this location, which in this example corresponds to the location marked at {`3`}. We know this because at offset `0x19` into `sub_401000` is the jmp at memory address `0x401019`.

	![](images/5/35.png)
	
	- View all code references
		- click the function name and press `X`

		![](images/5/36.png)
		
- Data Cross-References
	- Data cross-references are used to track the way data is accessed within a binary.
	- Data cross-reference to the `DWORD 0x7F000001` at {`1`}. The corresponding cross-reference tells us that this data is used in the function located at `0x401020`. The following line shows a data cross-reference for the `string <Hostname> <Port>`.

![](images/5/37.png)

- Analyzing Functions